syntax = "proto3";

option java_outer_classname = "SegmentYAGPCCP";
option go_package = "a.yandex-team.ru/cloud/mdb/yagpcc/api/proto/common;greenplum";

message MetricPlan {
    GpdbNodeType   type = 1;

    int32   plan_node_id = 2;
    int32   parent_plan_node_id = 3; // Valid only for QueryInfoMetricQuerySubmit 

    double  startup_cost = 4;	/* cost expended before fetching any tuples */
    double  total_cost = 5;	/* total cost (assuming all tuples fetched) */
    double  plan_rows = 6;	/* number of rows plan is expected to emit */
    int32   plan_width = 7;	/* average row width in bytes */

    int32   arg1 = 8;  // for some nodes it's additional opperand type
    int32   arg2 = 9;  // for some nodes it's additional opperand type

    MetricMotionInfo motion_info = 10;
    MetricRelationInfo relation_info = 11;
    
    string scan_index_name = 12;
    ScanDirection scan_direction = 13;
    MetricSliceInfo slice_info = 14;
    string statement = 15;
}

message MetricMotionInfo {
    MotionType   type = 1;
    bool         isBroadcast = 2;
    CdbLocusType locusType = 3;

    int32 sliceId = 4;
    int32 parentSliceId = 5;
}

message MetricRelationInfo {
    int32   oid = 1;
    string  name = 2;
    string  schema = 3;
    string  alias = 4;
    int32   dynamicScanId = 5;
}

message MetricSliceInfo {
    int32       slice = 1;
    int32       segments = 2;
    GangType    gangType = 3;
    int32       gang = 4;
}

enum ScanDirection
{
    SCAN_DIRECTION_UNSPECIFIED = 0;
    SCAN_DIRECTION_BACKWARD = 1;
    SCAN_DIRECTION_FORWARD = 2;
}

/* GangType enumeration is used in several structures related to CDB
 * slice plan support.
 */
enum GangType
{
    GANG_TYPE_UNSPECIFIED = 0;
    GANG_TYPE_UNALLOCATED = 1;       /* a root slice executed by the qDisp */
    GANG_TYPE_ENTRYDB_READER = 2;    /* a 1-gang with read access to the entry db */
    GANG_TYPE_SINGLETON_READER = 3;  /* a 1-gang to read the segment dbs */
    GANG_TYPE_PRIMARY_READER = 4;    /* a 1-gang or N-gang to read the segment dbs */
    GANG_TYPE_PRIMARY_WRITER = 5;    /* the N-gang that can update the segment dbs */
}


enum CdbLocusType
{
    CDB_LOCUS_TYPE_UNSPECIFIED = 0;
    CDB_LOCUS_TYPE_ENTRY = 1;       /* a single backend process on the entry db:
                                    * usually the qDisp itself, but could be a
                                    * qExec started by the entry postmaster.
                                    */

    CDB_LOCUS_TYPE_SINGLE_QE = 2;   /* a single backend process on any db: the
                                    * qDisp itself, or a qExec started by a
                                    * segment postmaster or the entry postmaster.
                                    */

    CDB_LOCUS_TYPE_GENERAL = 3;      /* compatible with any locus (data is
                                     * self-contained in the query plan or
                                     * generally available in any qExec or qDisp) */

    CDB_LOCUS_TYPE_SEGMENT_GENERAL = 4; /* generally available in any qExec, but not
                                         * available in qDisp */

    CDB_LOCUS_TYPE_REPLICATED = 5;    /* replicated over all qExecs of an N-gang */
    CDB_LOCUS_TYPE_HASHED = 6;        /* hash partitioned over all qExecs of N-gang */
    CDB_LOCUS_TYPE_HASHED_OJ = 7;     /* result of hash partitioned outer join, NULLs can be anywhere */
    CDB_LOCUS_TYPE_STREWN = 8;        /* partitioned on no known function */
    CDB_LOCUS_TYPE_END = 9;           /* = last valid CdbLocusType + 1 */
}

enum MotionType
{
    MOTION_TYPE_UNSPECIFIED = 0;
    MOTION_TYPE_HASH = 1;                // Use hashing to select a segindex destination
    MOTION_TYPE_FIXED = 2;               // Send tuples to a fixed set of segindexes
    MOTION_TYPE_EXPLICIT = 3;            // Send tuples to the segment explicitly specified in their segid column
}

enum GpdbNodeType {
	GPDB_NODE_TYPE_UNSPECIFIED = 0;
	INDEX_INFO = 1;
	EXPR_CONTEXT = 2;
	PROJECTION_INFO = 3;
	JUNK_FILTER = 4;
	RESULT_REL_INFO = 5;
	E_STATE = 6;
	TUPLE_TABLE_SLOT = 7;
	CDB_PROCESS = 8;
	SLICE = 9;
	SLICE_TABLE = 10;
	CURSOR_POS_INFO = 11;
	SHARE_NODE_ENTRY = 12;
	PARTITION_STATE = 13;
	QUERY_DISPATCH_DESC = 14;
	OID_ASSIGNMENT = 15;
	PLAN = 16;
	SCAN = 17;
	JOIN = 18;
	RESULT = 19;
	MODIFY_TABLE = 20;
	APPEND = 21;
	MERGE_APPEND = 22;
	RECURSIVE_UNION = 23;
	SEQUENCE = 24;
	BITMAP_AND = 25;
	BITMAP_OR = 26;
	SEQ_SCAN = 27;
	DYNAMIC_SEQ_SCAN = 28;
	EXTERNAL_SCAN = 29;
	INDEX_SCAN = 30;
	DYNAMIC_INDEX_SCAN = 31;
	INDEX_ONLY_SCAN = 32;
	BITMAP_INDEX_SCAN = 33;
	DYNAMIC_BITMAP_INDEX_SCAN = 34;
	BITMAP_HEAP_SCAN = 35;
	DYNAMIC_BITMAP_HEAP_SCAN = 36;
	TID_SCAN = 37;
	SUBQUERY_SCAN = 38;
	FUNCTION_SCAN = 39;
	TABLE_FUNCTION_SCAN = 40;
	VALUES_SCAN = 41;
	CTE_SCAN = 42;
	WORK_TABLE_SCAN = 43;
	FOREIGN_SCAN = 44;
	NEST_LOOP = 45;
	MERGE_JOIN = 46;
	HASH_JOIN = 47;
	MATERIAL = 48;
	SORT = 49;
	AGG = 50;
	WINDOW_AGG = 51;
	UNIQUE = 52;
	HASH = 53;
	SET_OP = 54;
	LOCK_ROWS = 55;
	LIMIT = 56;
	MOTION = 57;
	SHARE_INPUT_SCAN = 58;
	REPEAT = 59;
	DML = 60;
	SPLIT_UPDATE = 61;
	ROW_TRIGGER = 62;
	ASSERT_OP = 63;
	PARTITION_SELECTOR = 64;
	PLAN_END = 65;
	NEST_LOOP_PARAM = 66;
	PLAN_ROW_MARK = 67;
	PLAN_INVAL_ITEM = 68;
	PLAN_STATE = 69;
	SCAN_STATE = 70;
	JOIN_STATE = 71;
	RESULT_STATE = 72;
	MODIFY_TABLE_STATE = 73;
	APPEND_STATE = 74;
	MERGE_APPEND_STATE = 75;
	RECURSIVE_UNION_STATE = 76;
	SEQUENCE_STATE = 77;
	BITMAP_AND_STATE = 78;
	BITMAP_OR_STATE = 79;
	SEQ_SCAN_STATE = 80;
	DYNAMIC_SEQ_SCAN_STATE = 81;
	EXTERNAL_SCAN_STATE = 82;
	INDEX_SCAN_STATE = 83;
	DYNAMIC_INDEX_SCAN_STATE = 84;
	INDEX_ONLY_SCAN_STATE = 85;
	BITMAP_INDEX_SCAN_STATE = 86;
	DYNAMIC_BITMAP_INDEX_SCAN_STATE = 87;
	BITMAP_HEAP_SCAN_STATE = 88;
	DYNAMIC_BITMAP_HEAP_SCAN_STATE = 89;
	TID_SCAN_STATE = 90;
	SUBQUERY_SCAN_STATE = 91;
	FUNCTION_SCAN_STATE = 92;
	TABLE_FUNCTION_STATE = 93;
	VALUES_SCAN_STATE = 94;
	CTE_SCAN_STATE = 95;
	WORK_TABLE_SCAN_STATE = 96;
	FOREIGN_SCAN_STATE = 97;
	NEST_LOOP_STATE = 98;
	MERGE_JOIN_STATE = 99;
	HASH_JOIN_STATE = 100;
	MATERIAL_STATE = 101;
	SORT_STATE = 102;
	AGG_STATE = 103;
	WINDOW_AGG_STATE = 104;
	UNIQUE_STATE = 105;
	HASH_STATE = 106;
	SET_OP_STATE = 107;
	LOCK_ROWS_STATE = 108;
	LIMIT_STATE = 109;
	MOTION_STATE = 110;
	SHARE_INPUT_SCAN_STATE = 111;
	REPEAT_STATE = 112;
	DML_STATE = 113;
	SPLIT_UPDATE_STATE = 114;
	ROW_TRIGGER_STATE = 115;
	ASSERT_OP_STATE = 116;
	PARTITION_SELECTOR_STATE = 117;
	TUPLE_DESC_NODE = 118;
	SERIALIZED_PARAM_EXTERN_DATA = 119;
	ALIAS = 120;
	RANGE_VAR = 121;
	EXPR = 122;
	VAR = 123;
	CONST = 124;
	PARAM = 125;
	AGGREF = 126;
	WINDOW_FUNC = 127;
	ARRAY_REF = 128;
	FUNC_EXPR = 129;
	NAMED_ARG_EXPR = 130;
	OP_EXPR = 131;
	DISTINCT_EXPR = 132;
	NULL_IF_EXPR = 133;
	SCALAR_ARRAY_OP_EXPR = 134;
	BOOL_EXPR = 135;
	SUB_LINK = 136;
	SUB_PLAN = 137;
	ALTERNATIVE_SUB_PLAN = 138;
	FIELD_SELECT = 139;
	FIELD_STORE = 140;
	RELABEL_TYPE = 141;
	COERCE_VIA_IO = 142;
	ARRAY_COERCE_EXPR = 143;
	CONVERT_ROWTYPE_EXPR = 144;
	COLLATE_EXPR = 145;
	CASE_EXPR = 146;
	CASE_WHEN = 147;
	CASE_TEST_EXPR = 148;
	ARRAY_EXPR = 149;
	ROW_EXPR = 150;
	ROW_COMPARE_EXPR = 151;
	COALESCE_EXPR = 152;
	MIN_MAX_EXPR = 153;
	XML_EXPR = 154;
	NULL_TEST = 155;
	BOOLEAN_TEST = 156;
	COERCE_TO_DOMAIN = 157;
	COERCE_TO_DOMAIN_VALUES = 158;
	SET_TO_DEFAULT = 159;
	CURRENT_OF_EXPR = 160;
	TARGET_ENTRY = 161;
	RANGE_TBL_REF = 162;
	JOIN_EXPR = 163;
	FROM_EXPR = 164;
	INTO_CLAUSE = 165;
	COPY_INTO_CLAUSE = 166;
	REFRESH_CLAUSE = 167;
	FLOW = 168;
	GROUPING = 169;
	GROUP_ID = 170;
	DISTRIBUTED_BY = 171;
	DML_ACTION_EXPR = 172;
	PART_SELECTED_EXPR = 173;
	PART_DEFAULT_EXPR = 174;
	PART_BOUND_EXPR = 175;
	PART_BOUND_INCLUSION_EXPR = 176;
	PART_BOUND_OPEN_EXPR = 177;
	PART_LIST_RULE_EXPR = 178;
	PART_LIST_NULL_TEST_EXPR = 179;
	TABLE_OID_INFO = 180;
	EXPR_STATE = 181;
	GENERIC_EXPR_STATE = 182;
	WHOLE_ROW_VAR_EXPR_STATE = 183;
	AGGREF_EXPR_STATE = 184;
	WINDOW_FUNC_EXPR_STATE = 185;
	ARRAY_REF_EXPR_STATE = 186;
	FUNC_EXPR_STATE = 187;
	SCALAR_ARRAY_OP_EXPR_STATE = 188;
	BOOL_EXPR_STATE = 189;
	SUB_PLAN_STATE = 190;
	ALTERNATIVE_SUB_PLAN_STATE = 191;
	FIELD_SELECT_STATE = 192;
	FIELD_STORE_STATE = 193;
	COERCE_VIA_IO_STATE = 194;
	ARRAY_COERCE_EXPR_STATE = 195;
	CONVERT_ROWTYPE_EXPR_STATE = 196;
	CASE_EXPR_STATE = 197;
	CASE_WHEN_STATE = 198;
	ARRAY_EXPR_STATE = 199;
	ROW_EXPR_STATE = 200;
	ROW_COMPARE_EXPR_STATE = 201;
	COALESCE_EXPR_STATE = 202;
	MIN_MAX_EXPR_STATE = 203;
	XML_EXPR_STATE = 204;
	NULL_TEST_STATE = 205;
	COERCE_TO_DOMAIN_STATE = 206;
	DOMAIN_CONSTRAINT_STATE = 207;
	GROUPING_FUNC_EXPR_STATE = 208;
	PART_SELECTED_EXPR_STATE = 209;
	PART_DEFAULT_EXPR_STATE = 210;
	PART_BOUND_EXPR_STATE = 211;
	PART_BOUND_INCLUSION_EXPR_STATE = 212;
	PART_BOUND_OPEN_EXPR_STATE = 213;
	PART_LIST_RULE_EXPR_STATE = 214;
	PART_LIST_NULL_TEST_EXPR_STATE = 215;
	PLANNER_INFO = 216;
	PLANNER_GLOBAL = 217;
	REL_OPT_INFO = 218;
	INDEX_OPT_INFO = 219;
	PARAM_PATH_INFO = 220;
	PATH = 221;
	APPEND_ONLY_PATH = 222;
	AOCS_PATH = 223;
	EXTERNAL_PATH = 224;
	INDEX_PATH = 225;
	BITMAP_HEAP_PATH = 226;
	BITMAP_AND_PATH = 227;
	BITMAP_OR_PATH = 228;
	NEST_PATH = 229;
	MERGE_PATH = 230;
	HASH_PATH = 231;
	TID_PATH = 232;
	FOREIGN_PATH = 233;
	APPEND_PATH = 234;
	MERGE_APPEND_PATH = 235;
	RESULT_PATH = 236;
	MATERIAL_PATH = 237;
	UNIQUE_PATH = 238;
	PROJECTION_PATH = 239;
	EQUIVALENCE_CLASS = 240;
	EQUIVALENCE_MEMBER = 241;
	PATH_KEY = 242;
	RESTRICT_INFO = 243;
	PLACE_HOLDER_VAR = 244;
	SPECIAL_JOIN_INFO = 245;
	LATERAL_JOIN_INFO = 246;
	APPEND_REL_INFO = 247;
	PLACE_HOLDER_INFO = 248;
	MIN_MAX_AGG_INFO = 249;
	PARTITION = 250;
	PARTITION_RULE = 251;
	PARTITION_NODE = 252;
	PG_PART_RULE = 253;
	SEGFILE_MAP_NODE = 254;
	PLANNER_PARAM_ITEM = 255;
	CDB_MOTION_PATH = 256;
	PARTITION_SELECTOR_PATH = 257;
	CDB_REL_COLUMN_INFO = 258;
	DISTRIBUTION_KEY = 259;
	MEMORY_CONTEXT = 260;
	ALLOC_SET_CONTEXT = 261;
	MEMORY_ACCOUNT = 262;
	VALUE = 263;
	INTEGER = 264;
	FLOAT = 265;
	STRING = 266;
	BIT_STRING = 267;
	NULL_VALUE = 268;
	LIST = 269;
	INT_LIST = 270;
	OID_LIST = 271;
	QUERY = 272;
	PLANNED_STMT = 273;
	INSERT_STMT = 274;
	DELETE_STMT = 275;
	UPDATE_STMT = 276;
	SELECT_STMT = 277;
	ALTER_TABLE_STMT = 278;
	ALTER_TABLE_CMD = 279;
	ALTER_DOMAIN_STMT = 280;
	SET_OPERATION_STMT = 281;
	GRANT_STMT = 282;
	GRANT_ROLE_STMT = 283;
	ALTER_DEFAULT_PRIVILEGES_STMT = 284;
	CLOSE_PORTAL_STMT = 285;
	CLUSTER_STMT = 286;
	COPY_STMT = 287;
	CREATE_STMT = 288;
	SINGLE_ROW_ERROR_DESC = 289;
	EXT_TABLE_TYPE_DESC = 290;
	CREATE_EXTERNAL_STMT = 291;
	DEFINE_STMT = 292;
	DROP_STMT = 293;
	TRUNCATE_STMT = 294;
	COMMENT_STMT = 295;
	FETCH_STMT = 296;
	INDEX_STMT = 297;
	CREATE_FUNCTION_STMT = 298;
	ALTER_FUNCTION_STMT = 299;
	DO_STMT = 300;
	RENAME_STMT = 301;
	RULE_STMT = 302;
	NOTIFY_STMT = 303;
	LISTEN_STMT = 304;
	UNLISTEN_STMT = 305;
	TRANSACTION_STMT = 306;
	VIEW_STMT = 307;
	LOAD_STMT = 308;
	CREATE_DOMAIN_STMT = 309;
	CREATEDB_STMT = 310;
	DROPDB_STMT = 311;
	VACUUM_STMT = 312;
	EXPLAIN_STMT = 313;
	CREATE_TABLE_AS_STMT = 314;
	CREATE_SEQ_STMT = 315;
	ALTER_SEQ_STMT = 316;
	VARIABLE_SET_STMT = 317;
	VARIABLE_SHOW_STMT = 318;
	DISCARD_STMT = 319;
	CREATE_TRIG_STMT = 320;
	CREATE_P_LANG_STMT = 321;
	CREATE_ROLE_STMT = 322;
	ALTER_ROLE_STMT = 323;
	DROP_ROLE_STMT = 324;
	CREATE_QUEUE_STMT = 325;
	ALTER_QUEUE_STMT = 326;
	DROP_QUEUE_STMT = 327;
	CREATE_RESOURCE_GROUP_STMT = 328;
	DROP_RESOURCE_GROUP_STMT = 329;
	ALTER_RESOURCE_GROUP_STMT = 330;
	LOCK_STMT = 331;
	CONSTRAINTS_SET_STMT = 332;
	REINDEX_STMT = 333;
	CHECK_POINT_STMT = 334;
	CREATE_SCHEMA_STMT = 335;
	ALTER_DATABASE_STMT = 336;
	ALTER_DATABASE_SET_STMT = 337;
	ALTER_ROLE_SET_STMT = 338;
	CREATE_CONVERSION_STMT = 339;
	CREATE_CAST_STMT = 340;
	CREATE_OP_CLASS_STMT = 341;
	CREATE_OP_FAMILY_STMT = 342;
	ALTER_OP_FAMILY_STMT = 343;
	PREPARE_STMT = 344;
	EXECUTE_STMT = 345;
	DEALLOCATE_STMT = 346;
	DECLARE_CURSOR_STMT = 347;
	CREATE_TABLE_SPACE_STMT = 348;
	DROP_TABLE_SPACE_STMT = 349;
	ALTER_OBJECT_SCHEMA_STMT = 350;
	ALTER_OWNER_STMT = 351;
	DROP_OWNED_STMT = 352;
	REASSIGN_OWNED_STMT = 353;
	COMPOSITE_TYPE_STMT = 354;
	CREATE_ENUM_STMT = 355;
	CREATE_RANGE_STMT = 356;
	ALTER_ENUM_STMT = 357;
	ALTER_TS_DICTIONARY_STMT = 358;
	ALTER_TS_CONFIGURATION_STMT = 359;
	CREATE_FDW_STMT = 360;
	ALTER_FDW_STMT = 361;
	CREATE_FOREIGN_SERVER_STMT = 362;
	ALTER_FOREIGN_SERVER_STMT = 363;
	CREATE_USER_MAPPING_STMT = 364;
	ALTER_USER_MAPPING_STMT = 365;
	DROP_USER_MAPPING_STMT = 366;
	ALTER_TABLE_SPACE_OPTIONS_STMT = 367;
	ALTER_TABLE_MOVE_ALL_STMT = 368;
	SEC_LABEL_STMT = 369;
	CREATE_FOREIGN_TABLE_STMT = 370;
	CREATE_EXTENSION_STMT = 371;
	ALTER_EXTENSION_STMT = 372;
	ALTER_EXTENSION_CONTENTS_STMT = 373;
	CREATE_EVENT_TRIG_STMT = 374;
	ALTER_EVENT_TRIG_STMT = 375;
	REFRESH_MAT_VIEW_STMT = 376;
	REPLICA_IDENTITY_STMT = 377;
	ALTER_SYSTEM_STMT = 378;
	PARTITION_BY = 379;
	PARTITION_ELEM = 380;
	PARTITION_RANGE_ITEM = 381;
	PARTITION_BOUND_SPEC = 382;
	PARTITION_SPEC = 383;
	PARTITION_VALUES_SPEC = 384;
	ALTER_PARTITION_ID = 385;
	ALTER_PARTITION_CMD = 386;
	INHERIT_PARTITION_CMD = 387;
	CREATE_FILE_SPACE_STMT = 388;
	FILE_SPACE_ENTRY = 389;
	DROP_FILE_SPACE_STMT = 390;
	TABLE_VALUE_EXPR = 391;
	DENY_LOGIN_INTERVAL = 392;
	DENY_LOGIN_POINT = 393;
	ALTER_TYPE_STMT = 394;
	SET_DISTRIBUTION_CMD = 395;
	EXPAND_STMT_SPEC = 396;
	A_EXPR = 397;
	COLUMN_REF = 398;
	PARAM_REF = 399;
	A_CONST = 400;
	FUNC_CALL = 401;
	A_STAR = 402;
	A_INDICES = 403;
	A_INDIRECTION = 404;
	A_ARRAY_EXPR = 405;
	RES_TARGET = 406;
	TYPE_CAST = 407;
	COLLATE_CLAUSE = 408;
	SORT_BY = 409;
	WINDOW_DEF = 410;
	RANGE_SUBSELECT = 411;
	RANGE_FUNCTION = 412;
	TYPE_NAME = 413;
	COLUMN_DEF = 414;
	INDEX_ELEM = 415;
	CONSTRAINT = 416;
	DEF_ELEM = 417;
	RANGE_TBL_ENTRY = 418;
	RANGE_TBL_FUNCTION = 419;
	WITH_CHECK_OPTION = 420;
	GROUPING_CLAUSE = 421;
	GROUPING_FUNC = 422;
	SORT_GROUP_CLAUSE = 423;
	WINDOW_CLAUSE = 424;
	PRIV_GRANTEE = 425;
	FUNC_WITH_ARGS = 426;
	ACCESS_PRIV = 427;
	CREATE_OP_CLASS_ITEM = 428;
	TABLE_LIKE_CLAUSE = 429;
	FUNCTION_PARAMETER = 430;
	LOCKING_CLAUSE = 431;
	ROW_MARK_CLAUSE = 432;
	XML_SERIALIZE = 433;
	WITH_CLAUSE = 434;
	COMMON_TABLE_EXPR = 435;
	COLUMN_REFERENCE_STORAGE_DIRECTIVE = 436;
	IDENTIFY_SYSTEM_CMD = 437;
	BASE_BACKUP_CMD = 438;
	CREATE_REPLICATION_SLOT_CMD = 439;
	DROP_REPLICATION_SLOT_CMD = 440;
	START_REPLICATION_CMD = 441;
	TIME_LINE_HISTORY_CMD = 442;
	TRIGGER_DATA = 443;
	EVENT_TRIGGER_DATA = 444;
	RETURN_SET_INFO = 445;
	WINDOW_OBJECT_DATA = 446;
	TID_BITMAP = 447;
	INLINE_CODE_BLOCK = 448;
	FDW_ROUTINE = 449;
	STREAM_BITMAP = 450;
	FORMATTER_DATA = 451;
	EXT_PROTOCOL_DATA = 452;
	EXT_PROTOCOL_VALIDATOR_DATA = 453;
	SELECTED_PARTS = 454;
	COOKED_CONSTRAINT = 455;
	CDB_EXPLAIN_STAT_HDR = 456;
	GP_POLICY = 457;
	RETRIEVE_STMT = 458;
}
